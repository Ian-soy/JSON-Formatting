<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON格式化大师</title>
  <link rel="stylesheet" href="src/css/popup.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>JSON格式化大师</h1>
      <div class="header-actions">
        <button id="storage-info-btn" class="btn secondary storage-info-btn" title="存储情况 (快捷键: Ctrl+I)">
          <span class="storage-usage-indicator">--</span>
        </button>
        <button id="settings-btn" class="btn secondary"><span class="icon-container"></span></button>
      </div>
    </div>
    
    <div class="toolbar">
      <button id="format-btn" class="btn primary" title="格式化JSON"><span class="icon-container"></span></button>
      <button id="parse-string-btn" class="btn secondary" title="解析转义字符串"><span class="icon-container">🔍</span></button>
      <button id="minify-btn" class="btn secondary" title="压缩JSON"><span class="icon-container"></span></button>

      <button id="copy-btn" class="btn secondary" title="复制到剪贴板"><span class="icon-container"></span></button>
      <button id="download-btn" class="btn secondary" title="下载JSON文件"><span class="icon-container"></span></button>
      <button id="save-btn" class="btn secondary" title="保存JSON数据"><span class="icon-container"></span></button>
      <button id="convert-btn" class="btn secondary" title="格式转换"><span class="icon-container"></span></button>
      <button id="share-btn" class="btn secondary" title="分享JSON"><span class="icon-container"></span></button>

    </div>
    
    <!-- 主要内容区域：左右布局 -->
    <div class="main-content">
      <!-- 左侧：编辑器区域 -->
      <div class="editor-section">
        <div class="editor-container">
          <div class="line-numbers" id="line-numbers"></div>
          <textarea id="json-input" placeholder="在此粘贴JSON数据或者分享的数据地址..."></textarea>
          
          <!-- 空状态编辑器提示 -->
          <div class="empty-editor-overlay" id="empty-editor-overlay">
            <div class="empty-editor-message">
              <div class="empty-editor-icon">💾</div>
              <div class="empty-editor-title">请输入或粘贴JSON数据</div>
              <div class="empty-editor-desc">您可以输入或粘贴JSON数据，也可以直接粘贴分享链接</div>
              
              <div class="empty-editor-tips">
                <h4>快速操作提示：</h4>
                <ul>
                  <li>粘贴JSON数据后使用格式化功能</li>
                  <li>粘贴包含转义引号的JSON字符串后使用解析功能</li>
                  <li>粘贴分享链接自动导入JSON数据</li>
                  <li>右侧历史面板可加载保存的数据</li>
                </ul>
                <div style="margin-top: 15px;">
                  <button id="test-escaped-parsing-btn" style="padding: 8px 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                    🧪 测试JSON字符串解析
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 右侧：历史数据面板 -->
      <div class="history-section" id="history-section">
        <!-- 展开/折叠按钮 -->
        <div class="history-toggle-btn" id="history-toggle-btn" title="折叠历史面板">
          <span class="icon-container"></span>
        </div>
        <div class="history-header">
          <h3>历史数据</h3>
          <button id="refresh-history-btn" class="btn secondary"><span class="icon-container"></span></button>
        </div>
        <div class="history-list" id="history-list">
          <div class="no-data">暂无保存的数据</div>
        </div>
      </div>
    </div>
    
    <div class="status-bar">
      <span id="status-message">准备就绪</span>
      <span id="char-count">0 字符</span>
    </div>
    

    
    <div id="share-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>分享JSON数据</h2>
        
        <!-- 模态框内部提示区域 -->
        <div id="share-modal-message" class="modal-message" style="display: none;"></div>
        
        <div class="share-options">
          <input type="text" id="share-link" readonly>
          <button id="copy-share-link" class="btn primary">复制链接</button>
        </div>
        <!-- 分享统计信息 -->
        <div id="share-stats-container" class="share-stats-container"></div>
        <div class="share-help">
          <p><strong>使用说明：</strong></p>
          <ul>
            <li>复制分享链接发送给他人</li>
            <li>直接在编辑器中粘贴分享链接即可自动导入JSON</li>
            <li>支持智能分级压缩：小数据保持原始，大数据自动高效压缩</li>
            <li>极大JSON数据使用最大压缩算法，最多可节省70%空间</li>
            <li>支持缓存机制，重复分享相同数据更快速</li>
          </ul>
        </div>
      </div>
    </div>
    
    <div id="convert-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>格式转换</h2>
        <div class="convert-options">
          <button id="to-xml-btn" class="btn secondary">转换为XML</button>
          <button id="to-csv-btn" class="btn secondary">转换为CSV</button>
        </div>
      </div>
    </div>
    
    <!-- 保存模态框 -->
    <div id="save-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>保存JSON数据</h2>
        
        <!-- 模态框内部提示区域 -->
        <div id="save-modal-message" class="modal-message" style="display: none;"></div>
        
        <div class="save-form">
          <div class="form-group">
            <label for="save-title-input">标题：</label>
            <input type="text" id="save-title-input" placeholder="请输入保存标题" maxlength="50">
            <div class="error-message" id="save-title-error"></div>
          </div>
          <div class="form-actions">
            <button id="confirm-save-btn" class="btn primary">保存</button>
            <button id="cancel-save-btn" class="btn secondary">取消</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 设置面板 -->
    <div id="settings-panel" class="settings-panel">
      <div class="settings-content">
        <div class="settings-header">
          <h3>设置</h3>
        </div>
        <div class="settings-body">
          <div class="setting-group">
            <label for="max-items-input">最大保存条数：</label>
            <input type="number" id="max-items-input" min="1" max="50" value="10">
            <div class="setting-desc">最多可保存的JSON数据条数（1-50）</div>
            <div class="error-message" id="max-items-error"></div>
          </div>
          
          <div class="setting-group">
            <label for="expiration-days-input">过期时间（天）：</label>
            <input type="number" id="expiration-days-input" min="1" max="365" value="5">
            <div class="setting-desc">数据保存的有效天数（1-365）</div>
            <div class="error-message" id="expiration-days-error"></div>
          </div>
          
          <div class="setting-group">
            <label>存储信息：</label>
            <div class="storage-info">
              <div class="info-item">
                <span class="info-label">已保存：</span>
                <span id="current-items-count">0/10</span>
              </div>
              <div class="info-item">
                <span class="info-label">过期时间：</span>
                <span id="expiration-info">5天</span>
              </div>
              <div class="info-item">
                <span class="info-label">最旧数据：</span>
                <span id="oldest-item-date">无数据</span>
              </div>
            </div>
          </div>
          
          <div class="setting-group danger-zone">
            <label>危险操作：</label>
            <button id="clear-all-data-btn" class="btn danger">清除所有数据</button>
            <div class="setting-desc">此操作将删除所有保存的JSON数据，不可恢复</div>
          </div>
        </div>
        
        <div class="settings-footer">
          <button id="save-settings-btn" class="btn primary">保存设置</button>
          <button id="reset-settings-btn" class="btn secondary">重置</button>
          <button id="cancel-settings-btn" class="btn secondary">取消</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 工具模块 -->
  <script src="src/js/json-utils.js"></script>
  <script src="src/js/theme-manager.js"></script>
  <script src="src/js/font-manager.js"></script>
  <script src="src/js/share-manager.js"></script>

  <script src="src/js/performance-optimizer.js"></script>
  

  <script src="src/js/line-numbers.js"></script>
  <script src="src/js/format-converter.js"></script>
  <script src="src/js/icon-manager.js"></script>
  
  <!-- 新增模块 -->
  <script src="src/js/data-manager.js"></script>
  <script src="src/js/settings-manager.js"></script>
  <script src="src/js/history-manager.js"></script>
  
  <!-- 主应用脚本 -->
  <script src="src/js/popup.js"></script>
  

</body>
</html>